> 问题背景：

1. 您好！我是一名 stata 的初学者，刚学习就感觉到 stata 强大无比。目前，我遇到了一个数值型变量的问题，特向您请教，非常感谢！
2. 通过 `insheet` 导入 `csv格式` 的数据，对于不同的变量，csv 文件中保留有效位数并不完全一致。比如其中一个变量 x，保留了小数点后 3 位，但导入后就默认为浮点型了，进行数次条件删除后，筛选形成新的数据，但新数据与原数据在小数点位数不一致了。
3. 我可以通过 `format` 或者` recast` 将数据的显示格式修改为3 位，但其实际并不是 3 位。这导致我的条件判断语句无法正常执行。比如：我需要判断以上这个 `x` 变量大于 0.002 的个数，由于导入数据过程中，把 `0.002` 的值自动变成了`0.0020000000949949` (大于 0.002）。我的分类条件语句（`x <= 0.002` 为一类，而 `x > 0.002` 为另一类）就会产生错误判断。
4. 想请教老师，**怎么才能让这个变量在导入 stata 后与原数据保持一致呢？或者说怎么操作才能将结果正确地分类呢？**

> 回答：
1. 你在 `csv` 文件或 `Excel` 文件中看到的数据格式，比如 `0.002` 并不是这个观察值的真实面目，你看到的可能只是其`化妆后的摸样` —— **显示格式**。大家在 Excel 中，经常选中一列数据，然后**「右击 &rarr; 设定单元格格式」**，这其实都是在设定变量的显示格式。其真实数值可能是 `0.0020000000949949`！
2. 当你使用 `insheet` 或 `import excel` 等命令把 **Excel** 数据文档导入 Stata 时，导入的是其真实数值（`0.0020000000949949`），而不是 **0.002**。
3. 因此，你可以再导入前，把 **Excel** 中的观察值粘贴到一个文本文件中，看看其真实面目。也可以再导入 Stata 以后进行二次处理。比如，使用 `round()` 函数进行四舍五入。
4. 不过，多数情况下应该都没有问题。在你的问题中，你是预先设定了分组 **界点 (cut-point) = 0.002**，才会引发上述问题。

> 举个例子：

* 录入数据
```stata
clear
input x1
0.0020000000949949
0.0019000000949949
0.0031000000949949
end
```

* 产生一个新变量，取值为 x1 的四舍五入，`小数点后取 3 位有效数字`
```stata
gen x2 = round(x1,0.001) //四舍五入
```

* 测试1：将二者的显示格式设定为小数点后 `3 位有效数字`
```stata
format x1 x2 %4.3f
list x1 x2  //显示效果相同！它们真的一样吗？
```

* 测试2：将二者的显示格式设定为小数点后 `16 位有效数字`
```stata
format x1 x2 %18.16f
list x1 x2  //此时可以看出二者的差别了
```
* 启示： 在使用`条件判断语句`时要非常小心！
```stata
. gen str12 Yes1 = "==0.002" if x1==0.002
. replace   Yes1 = "!=0.002" if x1!=0.002

. gen str12 Yes2 = "==0.002" if x2==0.002
. replace   Yes2 = "!=0.002" if x2!=0.002

. order x1 Yes1 x2 Yes2

. list, noobs clean

  +-------------------------------------------------------------+
  |                 x1      Yes1                   x2      Yes2 |
  |-------------------------------------------------------------|
  | 0.0020000000949949   !=0.002   0.0020000000000000   ==0.002 |
  | 0.0019000000949949   !=0.002   0.0020000000000000   ==0.002 |
  | 0.0031000000949949   !=0.002   0.0030000000000000   !=0.002 |
  +-------------------------------------------------------------+
```

> 附：完整 Do-file
```stata
* 录入数据
clear
input x1
0.0020000000949949
0.0019000000949949
0.0031000000949949
end

* 产生一个新变量，取值为 x1 的四舍五入，`小数点后取 3 位有效数字`
gen x2 = round(x1,0.001) //四舍五入

* 测试1：将二者的显示格式设定为小数点后 `3 位有效数字`
format x1 x2 %4.3f
list x1 x2  //显示效果相同！它们真的一样吗？

* 测试2：将二者的显示格式设定为小数点后 `16 位有效数字`
format x1 x2 %18.16f
list x1 x2  //此时可以看出二者的差别了

* 启示: 在使用`条件判断语句`时要非常小心！
gen str12 Yes1 = "==0.002" if x1==0.002
replace   Yes1 = "!=0.002" if x1!=0.002

gen str12 Yes2 = "==0.002" if x2==0.002
replace   Yes2 = "!=0.002" if x2!=0.002

order x1 Yes1 x2 Yes2

list, noobs clean
```



>#### 关于我们
- 【**Stata 连享会(公众号：StataChina)**】由中山大学连玉君老师团队创办，旨在定期与大家分享 Stata 应用的各种经验和技巧。
- 公众号推文同步发布于 [【简书-Stata连享会】](http://www.jianshu.com/u/69a30474ef33) 和 [【知乎-连玉君Stata专栏】](https://www.zhihu.com/people/arlionn)。可以在**简书**和**知乎**中搜索关键词`Stata`或`Stata连享会`后关注我们。
- 推文中的相关数据和程序，以及 [Markdown 格式原文](https://gitee.com/arlionn/jianshu) 可以在 [【Stata连享会-码云】](https://gitee.com/arlionn) 中获取。[【Stata连享会-码云】](https://gitee.com/arlionn) 中还放置了诸多 Stata 资源和程序。如 [Stata命令导航](https://gitee.com/arlionn/stata/wikis/Home) ||  [stata-fundamentals](https://gitee.com/arlionn/stata-fundamentals) ||  [Propensity-score-matching-in-stata](https://gitee.com/arlionn/propensity-score-matching-in-stata) || [Stata-Training](https://gitee.com/arlionn/StataTraining) 等。


>#### 联系我们
- **欢迎赐稿：** 欢迎将您的文章或笔记投稿至`Stata连享会(公众号: StataChina)`，我们会保留您的署名；录用稿件达`五篇`以上，即可**免费**获得 Stata 现场培训 (初级或高级选其一) 资格。
- **意见和资料：** 欢迎您的宝贵意见，您也可以来信索取推文中提及的程序和数据。
- **招募英才：** 欢迎加入我们的团队，一起学习 Stata。合作编辑或撰写稿件五篇以上，即可**免费**获得 Stata 现场培训 (初级或高级选其一) 资格。
- **联系邮件：** StataChina@163.com


---
![欢迎加入Stata连享会(公众号: StataChina)](http://upload-images.jianshu.io/upload_images/7692714-398cf91cf605db0c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "扫码关注 Stata 连享会")

